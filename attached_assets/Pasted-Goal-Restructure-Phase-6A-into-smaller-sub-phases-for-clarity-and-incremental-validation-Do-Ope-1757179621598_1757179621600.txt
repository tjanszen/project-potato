Goal: Restructure Phase 6A into smaller sub-phases for clarity and incremental validation

Do:
- Open docs/agent_memory/imp_plans/v2.md
- Find the section starting with "PHASE 6A: Database Foundations"
- Replace that section with 4 sub-phases:

PHASE 6A-1: Schema Design & Constraints
Goal: Draft runs table schema with non-overlap guarantees and active run uniqueness.
Tasks:
- Design runs table schema (columns: id, user_id, span daterange, start_date, end_date, day_count, active)
- Implement PostgreSQL EXCLUDE constraint for non-overlapping spans
- Define uniqueness constraint for single active run per user
- Write invariant validation queries
Exit Criteria:
- Schema draft created and applies cleanly to dev DB
- Non-overlapping constraint verified with INSERT test
- Active run uniqueness enforced
Evidence to Collect:
- Run "\d runs" to confirm schema
- Insert overlapping spans and confirm failure

PHASE 6A-2: Fallback & Cross-DB Strategy
Goal: Ensure schema logic works in both Postgres and SQLite.
Tasks:
- Implement trigger-based overlap prevention for SQLite fallback
- Validate equivalent guarantees across Postgres and SQLite
- Add invariant queries for both engines
Exit Criteria:
- SQLite prevents overlapping spans with triggers
- Validation queries confirm no overlaps in either DB
Evidence to Collect:
- Insert overlapping spans in SQLite and confirm failure

PHASE 6A-3: Indexes & Performance
Goal: Optimize query performance for run lookups.
Tasks:
- Add indexes for efficient user_id + span lookups
- Benchmark queries for <10ms execution target
Exit Criteria:
- Queries return in <10ms on test dataset
- EXPLAIN ANALYZE shows index usage
Evidence to Collect:
- Run EXPLAIN ANALYZE on run lookups

PHASE 6A-4: Migrations & Rollback
Goal: Implement migration scripts and rollback plan.
Tasks:
- Write forward migration for runs table
- Add rollback script to drop runs table + constraints
- Update schema.ts and Drizzle relations
- Test migration/rollback on copy of prod DB
Exit Criteria:
- Migration runs cleanly forward and backward
- No corruption of existing day_marks table
- Rollback plan documented
Evidence to Collect:
- Run "npm run db:push --force" for forward migration
- Run "npm run db:rollback" for rollback

Proof:
- Confirm Phase 6A has been split into 4 sub-phases (6A-1 through 6A-4)
- Each sub-phase includes Goal, Tasks, Exit Criteria, and Evidence to Collect
